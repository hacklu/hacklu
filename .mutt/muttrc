##General options
set header_cache= "~/.mutt/.cache/"
set message_cachedir= "~/.mutt/.cache/"
set certificate_file= "~/.mutt/certificates"

#mailboxes imaps://imap.tongji.edu.cn/INBOX imaps://imap.tongji.edu.cn/family
set imap_check_subscribed  #this set the mutt to fecth all IMAP folders, so we don't need above two line

set ssl_starttls=yes
set ssl_force_tls = yes
set imap_keepalive = 300
unset imap_passive   # Allow Mutt to open new imap connection automatically.
set mail_check = 30
set timeout = 300
set mbox_type=Maildir

set header=no
set quit=ask-yes
set delete #don't ask, just do!
set move = no

##bind for index
bind index gg first-entry
bind index G last-entry
bind index R group-reply
bind index p recall-message
# Ctrl-R to mark all as read
macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"
bind index <space>  collapse-thread
##bind for pager
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
alternative_order text/plain text/enriched text/html
bind pager k  previous-line
bind pager j  next-line
bind pager gg top
bind pager G  bottom
bind pager R  group-reply

bind index,pager \Cf next-page
bind index,pager \Cb previous-page
bind index,pager N search-opposite

bind compose p postpone-message
set sort = threads
set sort_aux = reverse-last-date-received  # like gmail
set uncollapse_jump                        # don't collapse on an unread message
set sort_re                                # thread based on regex

set pager_stop
set fast_reply
#当你按 "t" 或者 "D" 之类的标记操作时，是否自动把光标移动到下一封信件。
set resolve=yes
set menu_scroll
set smart_wrap
unset markers #don't show '+' when long line
#当你在用 pager 看信件时，在 index 留出多少行显示邮件列表？
set pager_index_lines = 0
set pager_context     = 0

# composing 
set fcc_attach
set forward_format = "Fwd: %s"
set include
set forward_quote
set indent_str="> "
set recall=no  #don't ask recall-message when write new

#地址簿
set alias_file=~/.mutt/.mutt.alias
set sort_alias = alias
set reverse_alias = yes
source $alias_file
## Abook
#set query_command= "abook --mutt-query '%s'"
#macro index,pager  a "<pipe-message>abook --add-email-quiet<return>" "Add this sender to Abook"
bind editor <Tab> complete-query
#你发出的邮件保存到那个信箱文件？比如可以像我这样每个月发出的信件放在不同的文件里。
set record="~/Mail/=sent-mail-`date +%Y-%m`"
#你的终端支持哪一种编码的显示？这个必须和你的终端编码一样。推荐用utf8
#set charset="utf8"
#send_charset
#set send_charset="us-ascii:iso-8859-1:gb2312:utf-8"
#外部程序退出时，是否要求用户按一个键才返回。这在察看某些shell命令输出时是比要的，
#否则它们一下就消失了。
set wait_key=yes
#当你要把信件存到另一个信箱，而这个信箱已经存在时，是否提示附加？
set noconfirmappend
#是否把邮件头也放在编辑器里可以修改？
set edit_headers=no

#mutt显示日期为中文
set locale="zh_CN"
#有些没有设置字符编码时
#那就把不是 utf-8 的编码都映射到 gb2312
charset-hook !utf-8 gb2312

#把mutt发送的from域作为sendmail发送邮件的sender(否则会用user@localdomian)
set envelope_from=yes

set ascii_chars=yes
set auto_tag = yes
ignore "Authentication-Results:"
ignore "DomainKey-Signature:"
ignore "DKIM-Signature:"
hdr_order Date From To Cc
set editor = "vi"
set tmpdir="~/.mutt/.tmp"

alternative_order text/plain text/html *
#auto_view text/html application/msword
auto_view text/html 

set mailcap_path = ~/.mutt/.mailcap
#source ~/.mutt/.color
color header yellow black Subject:
color header brightcyan black .
color body brightyellow black [_a-z\.\$A-Z0-9-]+@[a-zA-Z0-9\./\-]+
color body yellow black (http|ftp)://[_a-zA-Z0-9\./~\-]+
color quoted green black
color signature brightblue black
# color indicator yellow blue
color attachment yellow black
color tree red black
color indicator black cyan
color status white blue
color tilde blue black
color normal default default

set status_format="%r %f [%?M?%M/?%m] %?n?%n new, ?%?p?%p postponed, ?%?t?%t +tagged, ?%?d?%d deleted, ? %?b?%b more to go.?%> %r"

set rfc2047_parameters=yes #中文附件名乱码

set tilde #will show a ~ at the bottom
set delete=yes
set sleep_time = 0  #speed up folders switch
bind index,pager "O" imap-fetch-mail
bind index,pager  previous-page #rebind backspace, input as ctrl+v backspace in vim, looks like ^?, this called caret notation

# Headers to ignore
ignore *
unignore date from to cc subject x-mailer resent-from reply-to
#sidebar
set sidebar_visible = no
macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'
# Ctrl-n, Ctrl-p to select next, previous folder.
# # Ctrl-o to open selected folder.
# Sidebar Navigation ---------------------------------
bind index,pager <down>   sidebar-next
bind index,pager <up>     sidebar-prev
bind index,pager <right>  sidebar-open
## Shortcuts
macro index,pager <f5> '<sync-mailbox><enter-command>source ~/.mutt/tongji<enter><change-folder>!<enter>'
macro index,pager <f6> '<sync-mailbox><enter-command>source ~/.mutt/gmail<enter><change-folder>!<enter>'
macro index 'c' '<change-folder>?<change-dir><home>^K=<enter>'

message-hook . "set mime_forward=ask-no"
message-hook "~h multipart" "set mime_forward=ask-yes"

source "gpg -dq $HOME/.mutt/.my-pwds.gpg |"
####accout1 tongji.edu.cn
source "~/.mutt/tongji"
# Here we use the $folder variable that has just been set in the sourced file.
# We must set it right now otherwise the 'folder' variable will change in the next sourced file.
folder-hook $folder 'source ~/.mutt/tongji'

## ACCOUNT2 gmail
source "~/.mutt/gmail"
folder-hook hacklu.newborn@gmail.com/ 'source ~/.mutt/gmail'
folder-hook hacklu.newborn@gmail.com/Family 'set realname="Yue Lu"'
